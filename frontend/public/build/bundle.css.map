{
  "version": 3,
  "file": "bundle.css",
  "sources": [
    "../../App.svelte",
    "../../List.svelte",
    "../../Map.svelte",
    "../../Header.svelte"
  ],
  "sourcesContent": [
    "<script>\n  \timport Map from './components/Map.svelte';\n  \timport List from './components/List.svelte';\n</script>\n\n<style>\n  .container {\n    height: 100vh;\n    display: flex;\n  }\n\n  .pane {\n    display: flex;\n    flex-direction: column;\n    max-height: 100vh;\n  }\n\n  .left {\n    align-items: center;\n    width: 30%;\n    justify-content: center;\n  }\n\n  .right {\n    justify-content: space-between;\n    width: 70%;\n  }\n</style>\n\n<div class=\"container\">\n  <div class=\"pane left\">\n    <List />\n  </div>\n  <div class=\"pane right\">\n    <Map />\n  </div>\n</div>\n",
    "<script>\n    import inView from 'in-view';\n    import { onDestroy } from 'svelte';\n    import { fly, fade } from 'svelte/transition';\n    \n    import Header from './Header.svelte';\n    import debounce from '../utils/debounce';\n    import incidents, {incidentItems, error, metadata} from '../stores/incidents';\n    import { activeListItem, activeMapItem } from '../stores.js';\n    import { activeCity } from '../consts.js';\n\n    import pagination, {currentPage, totalPages, totalItems, currentItems, itemsPerPage} from '../stores/pagination';\n\n    let listRef;\n\n    // Update list scroll position when active list item is updated via map\n    const unsubscribeActiveListItem = activeListItem.subscribe(newActiveListItem => {\n        if (listRef) {\n            const activeItem  =document.getElementById(\n                `list-item-${newActiveListItem}`\n            );\n            listRef.scrollTo({\n                top: activeItem.offsetTop - 130,\n                behavior: 'smooth'\n            });\n        }\n    });\n\n    function setActiveMapItem(index) {\n        activeMapItem.set(index);\n    }\n\n    /**\n     * Remove listener on unmount\n     */ \n    onDestroy(unsubscribeActiveListItem);\n\n    let visible = false;\n\n    $: visible = $incidentItems && $incidentItems.length;\n    $: pagination.update($metadata);\n    $: incidents.listItems(activeCity.name, {page: $currentPage, size:200});\n</script>\n\n<style>\n    #list-items {\n        display: flex;\n        flex-wrap: wrap;\n        overflow: scroll;\n    }\n\n    .list-item-wrapper {\n        width: 100%;\n        border-left: 1px solid #f6f6fc;\n        border-bottom: #ccc solid 1px;\n        cursor: pointer;\n    }\n\n    .list-item-wrapper.active { \n        border-left: 4px solid #ff3377;\n        transition: border-width 0.2s ease-out;\n    }\n\n    .list-item {\n        /* font-family: Helvetica, Arial, sans-serif;\n        font-size: 1.2em;\n        line-height: 1.5em; */\n        margin: 0px 40px 0px 40px;\n        padding-top: 8px;\n        padding-bottom: 12px;\n        display: flex;\n        flex-direction: column;\n    }\n\n    .list-item .description {\n        font-size: 1.2em;\n        line-height: 1.3em;\n        padding-bottom: 8px;\n    }\n\n    .list-item .meta {\n        font-size: 0.9em;\n        line-height: 1em;\n    }\n\n    .list-item .meta small {\n        font-weight: bold;\n    }\n\n    .error,\n    .loader {\n        margin: 30px 40px;\n    }\n\n    .error {\n        color: #f14668;\n        font-weight: 700;\n    }\n\n    .tail {\n        margin: 20px 40px;\n        padding-bottom: 40px;\n    }\n\n    .footer {\n        /* position: absolute; */\n        position: -webkit-sticky;\n        position: sticky; \n        bottom: 0px;\n        height: 40px;\n        width:100%;\n        background-color:#252529;\n        padding: 20px 40px;\n    }\n\n    .pagination {\n        display: flex;\n        flex-wrap: wrap;\n        justify-content: space-between;\n        max-width: 300px;\n        margin: 0 auto;\n    }\n\n    .pagination > button {\n       font-size: 12px;\n       padding: 4px 10px;\n    }\n    .pagination .count {\n        color: #f6f6fc;\n        font-weight: 700;\n        font-size: 12px;\n        line-height: 25px;\n    } \n</style>\n\n<div id=\"list-items\" bind:this=\"{listRef}\">\n  \n  <Header doAnimate={!visible}/>\n\n{#if $incidentItems && $incidentItems.length}\n  {#each $incidentItems as listItem, index}\n    <div on:click={_=>setActiveMapItem(index)} class=\"list-item-wrapper {$activeMapItem === index ? 'active': ''}\" id=\"list-item-{index}\" transition:fly=\"{{ y: 60, duration: 400 }}\">\n        <div class=\"list-item\">\n            <span class=\"description\">{listItem.description}</span>\n            <div class=\"meta\">\n                <small>Reported on </small><span class=\"date\">{listItem.date}</span> <small>At</small> <span class=\"address\">{listItem.address}</span>\n            </div>\n            <span>{listItem.codeLabel}</span>\n        </div>\n    </div>\n  {/each}\n{:else}\n    {#if $error}\n        <div class=\"error\">{@html $error}</div>\n    {:else}\n        <div class=\"loader\">Loading...</div>\n    {/if}\n{/if}\n\n  <div class=\"tail\">\n    <p>Project by Emiliano Burgos a.k.a <a href=\"https://github.com/goliatone\" target=\"_blank\">goliatone</a></p>\n    <p>Read more in the <a href=\"/about\" target=\"_blank\">about page</a></p>\n    <i>List of crimes reported in Sacramento during 01/01/06 and 01/02/06.</i>\n  </div>\n\n{#if visible}\n  <div class=\"footer\" transition:fly=\"{{ y: 40, duration: 600 }}\">\n    <div class=\"pagination\">\n        <button on:click={pagination.first}>First</button>\n        <button on:click={pagination.prev}>Prev</button>\n        <div class=\"count\">\n            <span>{$currentPage}</span> of <span>{$totalPages}</span>\n        </div>\n        <button on:click={pagination.next}>Next</button>\n        <button on:click={pagination.last}>Last</button>\n    </div>\n  </div>\n{/if}\n\n</div>\n",
    "<svelte:head>\n    <link href=\"https://api.tiles.mapbox.com/mapbox-gl-js/v1.9.1/mapbox-gl.css\" rel=\"stylesheet\" />\n</svelte:head>\n<script>\n    import mapboxgl from 'mapbox-gl/dist/mapbox-gl.js';\n    import { onMount, onDestroy } from 'svelte';\n\n    import { activeListItem, activeMapItem } from '../stores.js';\n    import incidents, {incidentItems} from '../stores/incidents';\n    import { accessToken, activeCity, categoryOptions } from '../consts.js';\n\n    let map;\n\n    /**\n     * We use this to filter out by type\n     */ \n    const layerIDs = [];\n\n    /**\n     * For each list item we generate an object with props for \n     * the given feature. Here we store metadata for each item\n     * so we can access it later when we interact with list items\n     * e.g. on click\n     */ \n    function generateFeature({ address, description, coordinates, codeLabel }, index) {\n        let {color, icon} = categoryOptions[codeLabel] || categoryOptions.other;\n\n        return {\n            type: 'Feature',\n            properties: {\n                description: `\n                    <h3>${description}</h3>\n                    <p>${address}</p>\n                `,\n                id: index,\n                icon,\n                color,\n                codeLabel\n            },\n            geometry: {\n                type: 'Point',\n                coordinates\n            }\n        };\n    }\n\n    /**\n     * Update current data source. \n     * This will render all new features\n     */ \n    function updateDataSource(features=[]) {\n        if(!map.loaded()){\n            return setTimeout(_ => {\n                updateDataSource(features);\n            }, 100);\n        }\n        map.getSource('places.source').setData({\n            type: 'FeatureCollection',\n            features: features.map(addFeature)\n        });\n\n        /**\n         * Animate map on first render\n         */ \n        map.flyTo({ \n            center: features[0].coordinates,\n            // essential: true,\n            curve: 1,\n            // speed: 0.9,\n            bearing: 0,\n            duration: 5200,\n            // zoom: 9,\n            // pitch: 0\n        });\n    }\n    window.updateDataSource = updateDataSource;\n\n    function initializeMap() {\n        mapboxgl.accessToken = accessToken;\n\n        /**\n         * dark-v10\n         * light-v10\n         */\n        const mapOptions =  {\n            container: 'map',\n            style: 'mapbox://styles/mapbox/dark-v10?optimize=true',\n            center: activeCity.center,\n            zoom: 15,\n            pitch: 60, // pitch in degrees\n            bearing: 30, // bearing in degrees\n        };\n\n        const onLoadQuery = { page: 1, size: 200 };\n    \n        map = new mapboxgl.Map(mapOptions);\n        const nav = new mapboxgl.NavigationControl();\n        \n        map.addControl(nav, 'top-right');\n\n        map.on('load', async _ => {\n\n            /**\n             * Add source \n             */ \n            map.addSource('places.source', {\n                type: 'geojson',\n                data: {\n                    type: 'FeatureCollection',\n                    features: []\n                }\n            });\n\n            /**\n             * Query backend for our first page of items\n             */ \n            await incidents.listItems('sacramento', onLoadQuery);\n        });\n    }\n\n    function addFeature(incident, index) {\n        /**\n         * Make our feature\n         */ \n        const feature = generateFeature(incident, index);\n        const symbol = feature.properties.icon;\n        const label = feature.properties.codeLabel;\n\n        const layerID = `poi-${symbol}`;\n        \n        if(!map.getLayer(layerID))  addLayer(layerID, symbol, label);\n\n        return feature;\n    }\n\n    function addLayer(layerID, symbol, label) {\n\n        map.addLayer({\n            id: layerID,\n            type: 'symbol',\n            source: 'places.source',\n            layout: {\n                'icon-image': `${symbol}-15`,\n                'icon-size': 2,\n                'icon-allow-overlap': true,\n                'text-field': label,\n                'text-font': [\n                    'Open Sans Bold',\n                    'Arial Unicode MS Bold'\n                ],\n                'text-size': 11,\n                'text-transform': 'uppercase',\n                'text-letter-spacing': 0.05,\n                'text-offset': [0, 1.5]\n            },\n                'paint': {\n                'text-color': '#202',\n                'text-halo-color': '#fff',\n                'text-halo-width': 2\n            },\n            filter: ['==', 'icon', symbol]\n        });\n            \n        layerIDs.push(layerID);\n\n        /**\n         * Manage Popup on click\n         */ \n        map.on('click', layerID, function({ features }) {\n            const match = features[0];\n            const coordinates = match.geometry.coordinates.slice();\n\n            setActiveMapItem(match.properties.id);\n            setActiveListItem(match.properties.id);\n        });\n\n        /**\n         * Feature should show pointer on hover\n         */\n        map.on('mouseenter', layerID, _=> {\n            map.getCanvas().style.cursor = 'pointer';\n        });\n\n        /**\n         * Remove cursor\n         */\n        map.on('mouseleave', layerID, _=> {\n            map.getCanvas().style.cursor = '';\n        });\n    }\n\n    /**\n     * Use reactivity to update map center when active \n     * item is updated via list, we update using store.\n     */\n    const unsubscribeActiveMapItem = activeMapItem.subscribe(newActiveMapItem => {\n        if (map) {\n            const item = $incidentItems[newActiveMapItem];\n\n            showPopup(item);\n\n            flyTo(item.coordinates);\n        }\n    });\n\n    function showPopup(item) {\n        const popUps = document.getElementsByClassName('mapboxgl-popup');\n        if (popUps[0]) popUps[0].remove();\n\n        let description = `\n            <h3>${item.description}</h3>\n            <p>${item.address}</p>\n        `;\n\n        new mapboxgl.Popup()\n            .setLngLat(item.coordinates)\n            .setHTML(description)\n            .addTo(map);\n    }\n\n    function flyTo(coordinates) {\n        map.flyTo({ \n            center: coordinates,\n            // essential: true,\n            curve: 1,\n            // speed: 0.8,\n            bearing: 0,\n            duration: 3200,\n            // zoom: 9,\n            // pitch: 0\n        });\n    }\n\n    function setActiveListItem(id) {\n        activeListItem.set(id);\n    }\n\n    function setActiveMapItem(id) {\n        activeMapItem.set(id);\n    }\n\n    /**\n     * Livecycle handler, register map on first\n     * render.\n     */ \n    onMount(initializeMap);\n\n    /**\n     * Remove listener on unmount\n     */ \n    onDestroy(unsubscribeActiveMapItem);\n\n    $: if($incidentItems.length) updateDataSource($incidentItems);\n\n</script>\n\n<style>\n    #map {\n        width: 100%;\n        height: 100%;\n        background-color: #393838;\n    }\n\n    #map:before {\n        box-shadow: 20px 0 10px -10px rgba(0, 0, 0, 0.15) inset;\n        content: '';\n        height: 100%;\n        left: 0;\n        position: absolute;\n        width: 20px;\n        z-index: 1000;\n    }\n</style>\n\n<div id=\"map\"></div>\n",
    "<script>\n\n    const totalFrames = 3;\n    const animationDuration = 1300;\n    const timePerFrame = 100;\n\n    let lastUpdated;\n    let timeSinceLastUpdate;\n    let frameNumber = 2;\n    \n    let cycles = 0;\n    let maxCycles = 3;\n    let nextAnimation; \n    let tid;\n\n    export let doAnimate = false;\n    export let showVersion = true;\n\n    export function start() {\n        doAnimate = true;\n        maxCycles = random(2, 8);\n        nextAnimation = random(1000, 30000);\n        requestAnimationFrame(step);\n    }\n\n    export function stop() {\n        doAnimate = false;\n        frameNumber = 2;\n        showVersion = false;\n        // clearTimeout(tid);\n        // if(nextAnimation) tid = setTimeout(start, nextAnimation);\n    }\n\n    function random(min, max) {\n        return Math.floor(Math.random() * (max - min + 1) + min);\n    }\n\n    function step(startTime) {\n        \n        if (!lastUpdated) lastUpdated = startTime;\n\n        timeSinceLastUpdate = startTime - lastUpdated;\n\n        if (timeSinceLastUpdate > timePerFrame) {\n            lastUpdated = startTime;\n            if (frameNumber >= totalFrames) {\n                cycles++;\n                frameNumber = 1;\n            } else {\n                frameNumber = frameNumber + 1;\n            }\n        }\n\n        if(doAnimate) {\n            if(cycles <= maxCycles) requestAnimationFrame(step);\n            else stop();\n        }\n    }\n\n    $: {\n        if(doAnimate) start();\n    }\n\n    window.animateEye = step;   \n\n</script>\n\n<style>\n    .head {\n        position: sticky;\n        position: -webkit-sticky;\n        top: 0;\n        width: 100%;\n        align-self: flex-start;\n        background-color: #f6f6fc;\n    }\n    .title {\n        margin: 30px 40px;\n        display: flex;\n        flex-direction: row;\n    }\n\n    .title > .logo > img {\n        width: 48px;\n        padding-right: 6px;\n    }\n\n    .version {\n        font-weight: 700;\n        font-size: .5em;\n        padding: 5px 10px;\n        color: #f6f6fc;\n        background-color: #00d1b2;\n        height: 10px;\n        border-radius: 3px;\n        margin-left: 20px;\n        transition: opacity 1s ease-in-out;\n        opacity: 1;\n    }\n\n    .hide {\n        opacity: 0;\n    }\n\n    h2 {\n        font-family: Helvetica, Arial, sans-serif;\n        text-transform: capitalize;\n        /** this is to compensate for the icons attribution padding **/\n        line-height: 16px; \n    }\n</style>\n\n<div class=\"head\">\n    <div class=\"title\">\n        <span class=\"logo\"><img src=\"/images/eye-0{frameNumber}.svg\" alt=\"logo\"/></span>\n        <h2>Overwatch</h2>\n        <div class=\"version {showVersion ? '' : 'hide'}\">v0.0.7</div>\n    </div>\n  </div>"
  ],
  "names": [],
  "mappings": "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"
}